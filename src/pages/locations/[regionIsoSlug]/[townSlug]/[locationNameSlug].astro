---
export const prerender = true;

import Banner from '~/components/Banner.astro';
import client from '~/lib/contentful';
import Layout from '~/layouts/Layout.astro';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';

import Breadcrumb from '~/components/Breadcrumb.astro';
import LadderTable from '~/components/LadderTable.astro';
import { toTitleCase, decodeRegion } from '~/utils/format.ts';

export async function getStaticPaths() {
  const response = await client.getEntries({
    content_type: 'triviaLocation',
  });

  console.log('[getStaticPaths] triviaLocation count:', response.items.length);

  return response.items.map((item) => ({
    params: {
      regionIsoSlug: item.fields.locationRegionIsoSlug,
      townSlug: item.fields.locationTownSlug,
      locationNameSlug: item.fields.locationNameSlug,
    },
    props: {
      location: item.fields,
      hero: item.fields.locationHero?.fields || null,
    },
  }));
}

const { location, hero } = Astro.props;
const { regionIsoSlug, townSlug, locationNameSlug } = Astro.params;

const address = `${location.locationStreetAddress}${
  location.locationAddressLine2 ? `, ${location.locationAddressLine2}` : ''
}, ${location.locationTown} ${location.locationPostcode}, ${location.locationRegion}, ${location.locationCountryIso}`;

const introHtml = location.locationIntro
  ? documentToHtmlString(location.locationIntro)
  : '';



const breadcrumbs = [
  { name: 'Locations', href: '/find' },
  { name: location.locationRegion, href: `/locations/${regionIsoSlug}` },
  { name: location.locationTown, href: `/locations/${regionIsoSlug}/${townSlug}` },
  { name: location.locationName },
];




const title = `${location.locationName} | Know Brainer Trivia`;
const image = location.locationSquare?.fields?.file?.url
  ? `https:${location.locationSquare.fields.file.url}`
  : undefined;



// SEO Values //
const pageTitle =  title
const pageDescription = introHtml

---
<Layout title={pageTitle} description={pageDescription} image={image}>

    <Banner />

  <!-- Breadcrumb stays constrained -->
  <div class="text-center max-w-7xl mx-auto px-4 mt-4">
    <Breadcrumb items={breadcrumbs} />
  </div>

<!-- LOCATION PANEL - FULL-BLEED HERO -->
<section class="mt-4 mb-4">
  <div class="w-full">
    <div
      class="grid grid-cols-1 lg:grid-cols-2 w-full
             lg:h-[60vh] lg:max-h-[480px]"
    >
      <!-- Left: Image (edge-to-edge) -->
      <div class="w-full h-88 lg:h-full lg:max-h-[480px]">
        <img
          src={`https:${hero?.file?.url}`}
          alt={location.locationImageAltText || hero?.title || location.locationName}
          class="w-full h-full object-cover"
          loading="lazy"
        />
      </div>

      <!-- Right: Info (edge-to-edge stone) -->
      <div class="w-full lg:h-full bg-stone p-8 flex flex-col justify-center text-left">
        <h1 class="text-4xl lg:text-6xl text-charcoal">{location.locationName}.</h1>
        <p class="text-sm lg:text-lg text-cardsub mb-6">
          {address}
        </p>

        <div class="flex flex-wrap justify-start items-center gap-4">
          <a href={location.locationWebURL} target="_blank" rel="noopener" aria-label="Website">
            <div class="bg-second rounded-full w-10 h-10 flex items-center justify-center">
              <iconify-icon icon="lucide:earth" width="20" height="20" class="text-white" />
            </div>
          </a>
          <a href={location.locationInstaURL} target="_blank" rel="noopener" aria-label="Instagram">
            <div class="bg-second rounded-full w-10 h-10 flex items-center justify-center">
              <iconify-icon icon="lucide:instagram" width="20" height="20" class="text-white" />
            </div>
          </a>
          <a href={location.locationFacebookURL} target="_blank" rel="noopener" aria-label="Facebook">
            <div class="bg-second rounded-full w-10 h-10 flex items-center justify-center">
              <iconify-icon icon="lucide:facebook" width="20" height="20" class="text-white" />
            </div>
          </a>

          <div class="flex items-center gap-2">
            <div class="bg-second rounded-full w-10 h-10 flex items-center justify-center">
              <iconify-icon icon="lucide:phone" width="20" height="20" class="text-white" />
            </div>
            <span class="text-lg text-main">{location.locationPhoneNumber}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>





<div class="h-0 bg-white"></div>


<!-- âœ… Outer Blue Panel Styled Like a Feature Card -->
 <section class="py-4 px-4 lg:12">
<div class="bg-second rounded-4xl overflow-hidden max-w-7xl mx-auto flex flex-col px-6 py-12 gap-8">

  <!-- ðŸ§  Weekly Info Line -->
  <h2 class="flex flex-wrap justify-center gap-3 text-white text-6xl text-center">
    <span class="uppercase">{location.locationFrequency}</span>
    <span>{location.locationDay}</span>
    <span>{location.locationTime}</span>
  </h2>

<!-- ðŸ”³ Responsive Card Grid -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">

  <!-- ðŸ”¹ Card 1: REGISTER (clickable) -->
<a
  href={location.locationFormURL}
  target="_blank"
  rel="noopener"
  class="bg-white rounded-xl p-6 flex flex-col items-center text-center group transition duration-150 ease-in-out 
         hover:shadow-lg hover:scale-105 hover:ring-4 ring-gray-200 
         active:ring-gray-300 active:bg-blue-100"
>
  <iconify-icon
    icon="lucide:square-pen"
    width="96"
    height="96"
    class="text-main mb-4 transition-transform duration-200 group-hover:scale-105"
  />
  <h2 class="text-4xl font-bold text-charcoal transition-transform duration-200 group-hover:scale-105">
    REGISTER
  </h2>
<div class="prose max-w-[200px] text-gray-800 mt-2">
  Register your team at <strong class="text-main font-bold">{location.locationName}</strong>.
</div>

</a>





  <!-- ðŸ”¹ Card 2: ABOUT -->
  <div class="bg-white rounded-xl p-6 flex flex-col items-center text-center group hover:shadow-lg transition">
    <iconify-icon
      icon="lucide:info"
      width="96"
      height="96"
      class="text-main mb-4 transition-transform duration-200 group-hover:scale-105"
    />
    <h2 class="text-4xl font-bold text-charcoal transition-transform duration-200 group-hover:scale-105">
      ABOUT
    </h2>
    <div class="prose max-w-[200px] text-gray-800 mt-2" set:html={introHtml}></div>
  </div>

  <!-- ðŸ”¹ Card 3: PRIZES -->
  <div class="bg-white rounded-xl p-6 flex flex-col items-center text-center group hover:shadow-lg transition">
    <iconify-icon
      icon="lucide:trophy"
      width="96"
      height="96"
      class="text-main mb-4 transition-transform duration-200 group-hover:scale-105"
    />
    <h2 class="text-4xl font-bold text-charcoal transition-transform duration-200 group-hover:scale-105">
      PRIZES
    </h2>
    <div class="prose max-w-[200px] text-gray-800 mt-2 space-y-2">
      <p>{location.locationPrize1}</p>
      <p>{location.locationPrize2}</p>
      <p>{location.locationPrize3}</p>
    </div>
  </div>

</div>






</div>
</section>



  <!-- White gap-->
  <div class="h-12 bg-white"></div>



<LadderTable ladderUrl={location.locationLadderURL} />


  <!-- White gap-->
  <div class="h-12 bg-white"></div>



</Layout>
