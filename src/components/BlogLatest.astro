---
import BlogCard from './BlogCard.astro';
import client from '../lib/contentful';

const response = await client.getEntries({
  content_type: 'triviaBlog',
  order: '-fields.blogPublished',
  limit: 3,
  include: 2,
});

const posts = response.items
  .filter((item: any) => item.fields.blogSlug && item.fields.blogTitle)
  .map((item: any) => {
    const { blogTitle, blogSlug, blogHero, blogAuthor, blogSummary, blogPublished } = item.fields;

    const imageUrl = blogHero?.fields?.file?.url
      ? `https:${blogHero.fields.file.url}`
      : null;

    const authorEntry = blogAuthor?.[0];
    const authorName = authorEntry?.fields?.authorName || 'Unknown';
    const authorSlug = authorEntry?.fields?.authorSlug || '';
    const authorImg = authorEntry?.fields?.authorImgprofile?.fields?.file?.url
      ? `https:${authorEntry.fields.authorImgprofile.fields.file.url}`
      : null;

    return {
      title: blogTitle,
      slug: blogSlug,
      imageUrl,
      imageAlt: item.fields.blogImageAltText,
      authorName,
      authorSlug,
      authorImg,
      summary: blogSummary || '',
      published: blogPublished || null, // raw for BlogCard's <time>
    };
  });
---

<section class="w-full py-8 px-4">
  <div class="max-w-6xl mx-auto text-center">
    <h2 class="text-7xl font-normal mb-4 text-main">Latest Blogs.</h2>

    <div class="mt-0 mb-4">
      <a 
        href="/blog" 
        class="inline-block w-64  px-4 py-2 rounded-xl  text-charcoal hover:bg-stone hover:underline transition"
      >
        View All
      </a>
    </div>

    {posts.length === 0 ? (
      <p class="text-gray-500">No blog posts found.</p>
    ) : (
      <>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10 justify-items-center">
          {posts.map((post) => (
            <BlogCard post={post} />
          ))}
        </div>



      </>
    )}
  </div>




</section>
